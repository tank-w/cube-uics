{"remainingRequest":"/Users/apple/www/vue/elmapp/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/apple/www/vue/elmapp/node_modules/cube-ui/src/components/recycle-list/recycle-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/apple/www/vue/elmapp/node_modules/cube-ui/src/components/recycle-list/recycle-list.vue","mtime":499162500000},{"path":"/Users/apple/www/vue/elmapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/www/vue/elmapp/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/apple/www/vue/elmapp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/www/vue/elmapp/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBDdWJlTG9hZGluZyBmcm9tICcuLi9sb2FkaW5nL2xvYWRpbmcudnVlJwppbXBvcnQgeyB3YXJuIH0gZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvZGVidWcuanMnCmltcG9ydCB7IGlzVW5kZWYgfSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy91dGlsLmpzJwoKY29uc3QgQ09NUE9ORU5UX05BTUUgPSAnY3ViZS1yZWN5Y2xlLWxpc3QnCmNvbnN0IFBST01JU0VfRVJST1IgPSAncmVxdWlyZXMgYSBQcm9taXNlIHBvbHlmaWxsIGluIHRoaXMgYnJvd3Nlci4nCmNvbnN0IEVWRU5UX1NDUk9MTCA9ICdzY3JvbGwnCmNvbnN0IEVWRU5UX1JFU0laRSA9ICdyZXNpemUnCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogQ09NUE9ORU5UX05BTUUsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGl0ZW1zOiBbXSwKICAgICAgaGVpZ2h0czogMCwKICAgICAgc3RhcnRJbmRleDogMCwKICAgICAgbG9hZGluZ3M6IFtdLAogICAgICBub01vcmU6IGZhbHNlCiAgICB9CiAgfSwKICBwcm9wczogewogICAgaW5maW5pdGU6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBzaXplOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogMjAKICAgIH0sCiAgICBvZmZzZXQ6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAxMDAKICAgIH0sCiAgICBvbkZldGNoOiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHZpc2libGVJdGVtcygpIHsKICAgICAgcmV0dXJuIHRoaXMuaXRlbXMuc2xpY2UoTWF0aC5tYXgoMCwgdGhpcy5zdGFydEluZGV4IC0gdGhpcy5zaXplKSwgTWF0aC5taW4odGhpcy5pdGVtcy5sZW5ndGgsIHRoaXMuc3RhcnRJbmRleCArIHRoaXMuc2l6ZSkpCiAgICB9LAogICAgdG9tYkhlaWdodCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaW5maW5pdGUgPyB0aGlzLiRyZWZzLnRvbWIgJiYgdGhpcy4kcmVmcy50b21iLm9mZnNldEhlaWdodCA6IDAKICAgIH0sCiAgICBsb2FkaW5nKCkgewogICAgICByZXR1cm4gdGhpcy5sb2FkaW5ncy5sZW5ndGgKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmxpc3QgPSBbXQogICAgdGhpcy5wcm9taXNlU3RhY2sgPSBbXQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuY2hlY2tQcm9taXNlQ29tcGF0aWJpbGl0eSgpCiAgICB0aGlzLiRlbC5hZGRFdmVudExpc3RlbmVyKEVWRU5UX1NDUk9MTCwgdGhpcy5fb25TY3JvbGwpCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihFVkVOVF9SRVNJWkUsIHRoaXMuX29uUmVzaXplKQogICAgdGhpcy5sb2FkKCkKICB9LAogIGJlZm9yZURlc3Ryb3koKSB7CiAgICB0aGlzLiRlbC5yZW1vdmVFdmVudExpc3RlbmVyKEVWRU5UX1NDUk9MTCwgdGhpcy5fb25TY3JvbGwpCiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihFVkVOVF9SRVNJWkUsIHRoaXMuX29uUmVzaXplKQogIH0sCiAgbWV0aG9kczogewogICAgY2hlY2tQcm9taXNlQ29tcGF0aWJpbGl0eSgpIHsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmIChpc1VuZGVmKHdpbmRvdy5Qcm9taXNlKSkgewogICAgICAgIHdhcm4oUFJPTUlTRV9FUlJPUikKICAgICAgfQogICAgfSwKICAgIGxvYWQoKSB7CiAgICAgIGlmICh0aGlzLmluZmluaXRlKSB7CiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLml0ZW1zCiAgICAgICAgY29uc3Qgc3RhcnQgPSBpdGVtcy5sZW5ndGgKICAgICAgICAvLyBpbmNyZWFzZSBjYXBhY2l0eSBvZiBpdGVtcyB0byBkaXNwbGF5IHRvbWJzdG9uZQogICAgICAgIGl0ZW1zLmxlbmd0aCArPSB0aGlzLnNpemUKICAgICAgICBjb25zdCBlbmQgPSBpdGVtcy5sZW5ndGgKICAgICAgICB0aGlzLmxvYWRJdGVtcyhzdGFydCwgZW5kKQogICAgICAgIHRoaXMuZ2V0SXRlbXMoKQogICAgICB9IGVsc2UgaWYgKCF0aGlzLmxvYWRpbmcpIHsKICAgICAgICB0aGlzLmdldEl0ZW1zKCkKICAgICAgfQogICAgfSwKICAgIGdldEl0ZW1zKCkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMucHJvbWlzZVN0YWNrLmxlbmd0aAogICAgICBjb25zdCBwcm9taXNlRmV0Y2ggPSB0aGlzLm9uRmV0Y2goKQogICAgICB0aGlzLmxvYWRpbmdzLnB1c2goJ3BlbmRpbmcnKQogICAgICB0aGlzLnByb21pc2VTdGFjay5wdXNoKHByb21pc2VGZXRjaCkKICAgICAgcHJvbWlzZUZldGNoLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMubG9hZGluZ3MucG9wKCkKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoIXJlcykgewogICAgICAgICAgdGhpcy5zdG9wU2Nyb2xsKGluZGV4KQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNldExpc3QoaW5kZXgsIHJlcykKICAgICAgICAgIHRoaXMubG9hZEl0ZW1zQnlJbmRleChpbmRleCkKICAgICAgICAgIGlmIChyZXMubGVuZ3RoIDwgdGhpcy5zaXplKSB7CiAgICAgICAgICAgIHRoaXMuc3RvcFNjcm9sbChpbmRleCkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgcmVtb3ZlVW51c2VkVG9tYnMoY29weSwgaW5kZXgpIHsKICAgICAgbGV0IGN1cnNvcgogICAgICBsZXQgc2l6ZSA9IHRoaXMuc2l6ZQogICAgICBsZXQgc3RhcnQgPSBpbmRleCAqIHNpemUKICAgICAgbGV0IGVuZCA9IChpbmRleCArIDEpICogc2l6ZQogICAgICBmb3IgKGN1cnNvciA9IHN0YXJ0OyBjdXJzb3IgPCBlbmQ7IGN1cnNvcisrKSB7CiAgICAgICAgaWYgKGNvcHlbY3Vyc29yXSAmJiBjb3B5W2N1cnNvcl0uaXNUb21ic3RvbmUpIGJyZWFrCiAgICAgIH0KICAgICAgdGhpcy5pdGVtcyA9IGNvcHkuc2xpY2UoMCwgY3Vyc29yKQogICAgfSwKICAgIHN0b3BTY3JvbGwoaW5kZXgpIHsKICAgICAgdGhpcy5ub01vcmUgPSB0cnVlCiAgICAgIHRoaXMucmVtb3ZlVW51c2VkVG9tYnModGhpcy5pdGVtcy5zbGljZSgwKSwgaW5kZXgpCiAgICAgIHRoaXMudXBkYXRlSXRlbVRvcCgpCiAgICAgIHRoaXMudXBkYXRlU3RhcnRJbmRleCgpCiAgICB9LAogICAgc2V0TGlzdChpbmRleCwgcmVzKSB7CiAgICAgIGNvbnN0IGxpc3QgPSB0aGlzLmxpc3QKICAgICAgY29uc3QgYmFzZUluZGV4ID0gaW5kZXggKiB0aGlzLnNpemUKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsaXN0W2Jhc2VJbmRleCArIGldID0gcmVzW2ldCiAgICAgIH0KICAgIH0sCiAgICBsb2FkSXRlbXNCeUluZGV4KGluZGV4KSB7CiAgICAgIGNvbnN0IHNpemUgPSB0aGlzLnNpemUKICAgICAgY29uc3Qgc3RhcnQgPSBpbmRleCAqIHNpemUKICAgICAgY29uc3QgZW5kID0gKGluZGV4ICsgMSkgKiBzaXplCiAgICAgIHRoaXMubG9hZEl0ZW1zKHN0YXJ0LCBlbmQpCiAgICB9LAogICAgbG9hZEl0ZW1zKHN0YXJ0LCBlbmQpIHsKICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLml0ZW1zCiAgICAgIGxldCBwcm9taXNlVGFza3MgPSBbXQogICAgICBsZXQgaXRlbQogICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykgewogICAgICAgIGl0ZW0gPSBpdGVtc1tpXQogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmIChpdGVtICYmIGl0ZW0ubG9hZGVkKSB7CiAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KICAgICAgICB0aGlzLnNldEl0ZW0oaSwgdGhpcy5saXN0W2ldKQogICAgICAgIC8vIGdldCBlYWNoIGl0ZW0ncyBoZWlnaHQgaW4gbmV4dFRpY2sKICAgICAgICBwcm9taXNlVGFza3MucHVzaCh0aGlzLiRuZXh0VGljaygpLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy51cGRhdGVJdGVtSGVpZ2h0KGkpCiAgICAgICAgfSkpCiAgICAgIH0KICAgICAgLy8gdXBkYXRlIGl0ZW1zIHRvcCBhbmQgZnVsbCBsaXN0IGhlaWdodAogICAgICB3aW5kb3cuUHJvbWlzZS5hbGwocHJvbWlzZVRhc2tzKS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLnVwZGF0ZUl0ZW1Ub3AoKQogICAgICAgIHRoaXMudXBkYXRlU3RhcnRJbmRleCgpCiAgICAgIH0pCiAgICB9LAogICAgc2V0SXRlbShpbmRleCwgZGF0YSkgewogICAgICB0aGlzLiRzZXQodGhpcy5pdGVtcywgaW5kZXgsIHsKICAgICAgICBkYXRhOiBkYXRhIHx8IHt9LAogICAgICAgIGhlaWdodDogMCwKICAgICAgICB0b3A6IC0xMDAwLAogICAgICAgIGlzVG9tYnN0b25lOiAhZGF0YSwKICAgICAgICBsb2FkZWQ6IGRhdGEgPyAxIDogMAogICAgICB9KQogICAgfSwKICAgIHVwZGF0ZUl0ZW1IZWlnaHQoaW5kZXgpIHsKICAgICAgLy8gdXBkYXRlIGl0ZW0gaGVpZ2h0CiAgICAgIGxldCBjdXIgPSB0aGlzLml0ZW1zW2luZGV4XQogICAgICBsZXQgZG9tID0gdGhpcy4kcmVmc1sncHJlbG9hZHMnICsgaW5kZXhdCiAgICAgIGlmIChkb20gJiYgZG9tWzBdKSB7CiAgICAgICAgY3VyLmhlaWdodCA9IGRvbVswXS5vZmZzZXRIZWlnaHQKICAgICAgfSBlbHNlIGlmIChjdXIpIHsKICAgICAgICBjdXIuaGVpZ2h0ID0gdGhpcy50b21iSGVpZ2h0CiAgICAgIH0KICAgIH0sCiAgICB1cGRhdGVJdGVtVG9wKCkgewogICAgICBsZXQgaGVpZ2h0cyA9IDAKICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLml0ZW1zCiAgICAgIGxldCBwcmUKICAgICAgbGV0IGN1cnJlbnQKICAgICAgLy8gbG9vcCBhbGwgaXRlbXMgdG8gdXBkYXRlIGl0ZW0gdG9wIGFuZCBsaXN0IGhlaWdodAogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcHJlID0gaXRlbXNbaSAtIDFdCiAgICAgICAgY3VycmVudCA9IGl0ZW1zW2ldCiAgICAgICAgLy8gaXQgaXMgZW1wdHkgaW4gYXJyYXkKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoIWl0ZW1zW2ldKSB7CiAgICAgICAgICBoZWlnaHRzICs9IDAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudC50b3AgPSBwcmUgPyBwcmUudG9wICsgcHJlLmhlaWdodCA6IDAKICAgICAgICAgIGhlaWdodHMgKz0gY3VycmVudC5oZWlnaHQKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5oZWlnaHRzID0gaGVpZ2h0cwogICAgfSwKICAgIHVwZGF0ZVN0YXJ0SW5kZXgoKSB7CiAgICAgIC8vIHVwZGF0ZSB2aXNpYmxlIGl0ZW1zIHN0YXJ0IGluZGV4CiAgICAgIGxldCB0b3AgPSB0aGlzLiRlbC5zY3JvbGxUb3AKICAgICAgbGV0IGl0ZW0KICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLml0ZW1zCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpdGVtID0gaXRlbXNbaV0KICAgICAgICBpZiAoIWl0ZW0gfHwgaXRlbS50b3AgPiB0b3ApIHsKICAgICAgICAgIHRoaXMuc3RhcnRJbmRleCA9IE1hdGgubWF4KDAsIGkgLSAxKQogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICByZXNldCAoKSB7CiAgICAgIGNvbnN0IG1hcCA9IFsKICAgICAgICB7CiAgICAgICAgICBrZXk6ICdpdGVtcycsCiAgICAgICAgICB2YWx1ZTogW10KICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGtleTogJ2hlaWdodHMnLAogICAgICAgICAgdmFsdWU6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGtleTogJ3N0YXJ0SW5kZXgnLAogICAgICAgICAgdmFsdWU6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGtleTogJ2xvYWRpbmdzJywKICAgICAgICAgIHZhbHVlOiBbXQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAga2V5OiAnbm9Nb3JlJywKICAgICAgICAgIHZhbHVlOiBmYWxzZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAga2V5OiAnbGlzdCcsCiAgICAgICAgICB2YWx1ZTogW10KICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGtleTogJ3Byb21pc2VTdGFjaycsCiAgICAgICAgICB2YWx1ZTogW10KICAgICAgICB9CiAgICAgIF0KICAgICAgbWFwLmZvckVhY2goKHsga2V5LCB2YWx1ZSB9KSA9PiB7CiAgICAgICAgdGhpc1trZXldID0gdmFsdWUKICAgICAgfSkKICAgICAgdGhpcy4kZWwuc2Nyb2xsVG9wID0gMAogICAgICB0aGlzLmxvYWQoKQogICAgfSwKICAgIF9vblNjcm9sbCgpIHsKICAgICAgLy8gdHJpZ2dlciBsb2FkCiAgICAgIGlmICghdGhpcy5ub01vcmUgJiYgdGhpcy4kZWwuc2Nyb2xsVG9wICsgdGhpcy4kZWwub2Zmc2V0SGVpZ2h0ID4gdGhpcy5oZWlnaHRzIC0gdGhpcy5vZmZzZXQpIHsKICAgICAgICB0aGlzLmxvYWQoKQogICAgICB9CiAgICAgIHRoaXMudXBkYXRlU3RhcnRJbmRleCgpCiAgICB9LAogICAgX29uUmVzaXplKCkgewogICAgICBjb25zdCBpdGVtcyA9IHRoaXMuaXRlbXMKICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICAgIGl0ZW0ubG9hZGVkID0gZmFsc2UKICAgICAgfSkKICAgICAgdGhpcy5sb2FkSXRlbXMoMCwgaXRlbXMubGVuZ3RoKQogICAgfQogIH0sCiAgY29tcG9uZW50czogewogICAgQ3ViZUxvYWRpbmcKICB9Cn0K"},{"version":3,"sources":["recycle-list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"recycle-list.vue","sourceRoot":"node_modules/cube-ui/src/components/recycle-list","sourcesContent":["<template>\n  <div class=\"cube-recycle-list\">\n    <div class=\"cube-recycle-list-main\">\n      <div class=\"cube-recycle-list-items\" :style=\"{height: heights + 'px'}\">\n        <div\n          v-for=\"item in visibleItems\"\n          class=\"cube-recycle-list-item\"\n          :style=\"{transform: 'translate(0,' + item.top + 'px)'}\"\n        >\n          <div\n            v-if=\"infinite\"\n            :class=\"{'cube-recycle-list-transition': infinite}\"\n            :style=\"{opacity: +!item.loaded}\"\n          >\n            <slot name=\"tombstone\"></slot>\n          </div>\n          <div\n            :class=\"{'cube-recycle-list-transition': infinite}\"\n            :style=\"{opacity: item.loaded}\"\n          >\n            <slot name=\"item\" :data=\"item.data\"></slot>\n          </div>\n        </div>\n\n        <!-- preloads item for get its height, remove it after caculating height-->\n        <div class=\"cube-recycle-list-pool\">\n          <div\n            class=\"cube-recycle-list-item cube-recycle-list-invisible\"\n            v-if=\"item && !item.isTombstone && !item.height\"\n            :ref=\"'preloads'+index\"\n            v-for=\"(item, index) in items\"\n          >\n            <slot name=\"item\" :data=\"item.data\"></slot>\n          </div>\n          <div ref=\"tomb\" class=\"cube-recycle-list-item cube-recycle-list-invisible\">\n            <slot name=\"tombstone\"></slot>\n          </div>\n        </div>\n      </div>\n      <div\n        v-if=\"!infinite && !noMore\"\n        class=\"cube-recycle-list-loading\"\n        :style=\"{visibility: loading ? 'visible' : 'hidden'}\"\n      >\n        <slot name=\"spinner\">\n          <div class=\"cube-recycle-list-loading-content\">\n            <cube-loading class=\"cube-recycle-list-spinner\"></cube-loading>\n          </div>\n        </slot>\n      </div>\n\n      <div v-show=\"noMore\" class=\"cube-recycle-list-noMore\">\n        <slot name=\"noMore\" />\n      </div>\n    </div>\n    <div class=\"cube-recycle-list-fake\"></div>\n  </div>\n</template>\n\n<script>\n  import CubeLoading from '../loading/loading.vue'\n  import { warn } from '../../common/helpers/debug.js'\n  import { isUndef } from '../../common/helpers/util.js'\n\n  const COMPONENT_NAME = 'cube-recycle-list'\n  const PROMISE_ERROR = 'requires a Promise polyfill in this browser.'\n  const EVENT_SCROLL = 'scroll'\n  const EVENT_RESIZE = 'resize'\n\n  export default {\n    name: COMPONENT_NAME,\n    data() {\n      return {\n        items: [],\n        heights: 0,\n        startIndex: 0,\n        loadings: [],\n        noMore: false\n      }\n    },\n    props: {\n      infinite: {\n        type: Boolean,\n        default: false\n      },\n      size: {\n        type: Number,\n        default: 20\n      },\n      offset: {\n        type: Number,\n        default: 100\n      },\n      onFetch: {\n        type: Function,\n        required: true\n      }\n    },\n    computed: {\n      visibleItems() {\n        return this.items.slice(Math.max(0, this.startIndex - this.size), Math.min(this.items.length, this.startIndex + this.size))\n      },\n      tombHeight() {\n        return this.infinite ? this.$refs.tomb && this.$refs.tomb.offsetHeight : 0\n      },\n      loading() {\n        return this.loadings.length\n      }\n    },\n    created() {\n      this.list = []\n      this.promiseStack = []\n    },\n    mounted() {\n      this.checkPromiseCompatibility()\n      this.$el.addEventListener(EVENT_SCROLL, this._onScroll)\n      window.addEventListener(EVENT_RESIZE, this._onResize)\n      this.load()\n    },\n    beforeDestroy() {\n      this.$el.removeEventListener(EVENT_SCROLL, this._onScroll)\n      window.removeEventListener(EVENT_RESIZE, this._onResize)\n    },\n    methods: {\n      checkPromiseCompatibility() {\n        /* istanbul ignore if */\n        if (isUndef(window.Promise)) {\n          warn(PROMISE_ERROR)\n        }\n      },\n      load() {\n        if (this.infinite) {\n          const items = this.items\n          const start = items.length\n          // increase capacity of items to display tombstone\n          items.length += this.size\n          const end = items.length\n          this.loadItems(start, end)\n          this.getItems()\n        } else if (!this.loading) {\n          this.getItems()\n        }\n      },\n      getItems() {\n        const index = this.promiseStack.length\n        const promiseFetch = this.onFetch()\n        this.loadings.push('pending')\n        this.promiseStack.push(promiseFetch)\n        promiseFetch.then((res) => {\n          this.loadings.pop()\n          /* istanbul ignore if */\n          if (!res) {\n            this.stopScroll(index)\n          } else {\n            this.setList(index, res)\n            this.loadItemsByIndex(index)\n            if (res.length < this.size) {\n              this.stopScroll(index)\n            }\n          }\n        })\n      },\n      removeUnusedTombs(copy, index) {\n        let cursor\n        let size = this.size\n        let start = index * size\n        let end = (index + 1) * size\n        for (cursor = start; cursor < end; cursor++) {\n          if (copy[cursor] && copy[cursor].isTombstone) break\n        }\n        this.items = copy.slice(0, cursor)\n      },\n      stopScroll(index) {\n        this.noMore = true\n        this.removeUnusedTombs(this.items.slice(0), index)\n        this.updateItemTop()\n        this.updateStartIndex()\n      },\n      setList(index, res) {\n        const list = this.list\n        const baseIndex = index * this.size\n        for (let i = 0; i < res.length; i++) {\n          list[baseIndex + i] = res[i]\n        }\n      },\n      loadItemsByIndex(index) {\n        const size = this.size\n        const start = index * size\n        const end = (index + 1) * size\n        this.loadItems(start, end)\n      },\n      loadItems(start, end) {\n        const items = this.items\n        let promiseTasks = []\n        let item\n        for (let i = start; i < end; i++) {\n          item = items[i]\n          /* istanbul ignore if */\n          if (item && item.loaded) {\n            continue\n          }\n          this.setItem(i, this.list[i])\n          // get each item's height in nextTick\n          promiseTasks.push(this.$nextTick().then(() => {\n            this.updateItemHeight(i)\n          }))\n        }\n        // update items top and full list height\n        window.Promise.all(promiseTasks).then(() => {\n          this.updateItemTop()\n          this.updateStartIndex()\n        })\n      },\n      setItem(index, data) {\n        this.$set(this.items, index, {\n          data: data || {},\n          height: 0,\n          top: -1000,\n          isTombstone: !data,\n          loaded: data ? 1 : 0\n        })\n      },\n      updateItemHeight(index) {\n        // update item height\n        let cur = this.items[index]\n        let dom = this.$refs['preloads' + index]\n        if (dom && dom[0]) {\n          cur.height = dom[0].offsetHeight\n        } else if (cur) {\n          cur.height = this.tombHeight\n        }\n      },\n      updateItemTop() {\n        let heights = 0\n        const items = this.items\n        let pre\n        let current\n        // loop all items to update item top and list height\n        for (let i = 0; i < items.length; i++) {\n          pre = items[i - 1]\n          current = items[i]\n          // it is empty in array\n          /* istanbul ignore if */\n          if (!items[i]) {\n            heights += 0\n          } else {\n            current.top = pre ? pre.top + pre.height : 0\n            heights += current.height\n          }\n        }\n        this.heights = heights\n      },\n      updateStartIndex() {\n        // update visible items start index\n        let top = this.$el.scrollTop\n        let item\n        const items = this.items\n        for (let i = 0; i < items.length; i++) {\n          item = items[i]\n          if (!item || item.top > top) {\n            this.startIndex = Math.max(0, i - 1)\n            break\n          }\n        }\n      },\n      reset () {\n        const map = [\n          {\n            key: 'items',\n            value: []\n          },\n          {\n            key: 'heights',\n            value: 0\n          },\n          {\n            key: 'startIndex',\n            value: 0\n          },\n          {\n            key: 'loadings',\n            value: []\n          },\n          {\n            key: 'noMore',\n            value: false\n          },\n          {\n            key: 'list',\n            value: []\n          },\n          {\n            key: 'promiseStack',\n            value: []\n          }\n        ]\n        map.forEach(({ key, value }) => {\n          this[key] = value\n        })\n        this.$el.scrollTop = 0\n        this.load()\n      },\n      _onScroll() {\n        // trigger load\n        if (!this.noMore && this.$el.scrollTop + this.$el.offsetHeight > this.heights - this.offset) {\n          this.load()\n        }\n        this.updateStartIndex()\n      },\n      _onResize() {\n        const items = this.items\n        items.forEach((item) => {\n          item.loaded = false\n        })\n        this.loadItems(0, items.length)\n      }\n    },\n    components: {\n      CubeLoading\n    }\n  }\n</script>\n\n<style lang=\"stylus\" rel=\"stylesheet/stylus\">\n  .cube-recycle-list\n    position: relative\n    height: 100%\n    overflow-x: hidden\n    overflow-y: auto\n    -webkit-overflow-scrolling: touch\n\n  .cube-recycle-list-main\n    min-height: 100%\n\n  .cube-recycle-list-fake\n    height: 1px\n\n  .cube-recycle-list-invisible\n    top: -1000px\n    visibility: hidden\n\n  .cube-recycle-list-item\n    width: 100%\n    position: absolute\n    box-sizing: border-box\n\n  .cube-recycle-list-transition\n    position: absolute\n    opacity: 0\n    transition-property: opacity\n    transition-duration: 500ms\n\n  .cube-recycle-list-loading\n    overflow: hidden\n\n  .cube-recycle-list-loading-content\n    text-align: center\n  .cube-recycle-list-spinner\n    margin: 10px auto\n    display: flex\n    justify-content: center\n</style>\n"]}]}